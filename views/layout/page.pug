-
    const itemClass = (baseClass, ...itemClasses) => [baseClass, ...itemClasses].filter((c) => !!c).join('__');
    const baseWithVariants = (base, ...variants) => {
        return [
            base, 
            ...variants
                .filter((v) => !!v)
                .map((v) => `${base}--${v}`)
        ];
    };
    const itemWithVariants = (base, item, ...variants) => 
        baseWithVariants(itemClass(base, item), ...variants);

    const navClass = 'nav';
    const navItemClass = itemClass(navClass, 'item');


mixin navlink(id, href, icon, title, ...variants)
    -
        let classes = baseWithVariants(navItemClass, ...variants, id && view === id ? 'active' : null);
    a(href=href, class=classes)&attributes(attributes)
        i.icon= icon
        = title

mixin navigation
    nav(class=navClass)
        if locals.user
            +navlink(null, '/auth/logout', 'exit_to_app', 'Log out')
        else
            +navlink(null, '/auth/login', 'person_outline', 'Log in', 'icon')

doctype html
html(lang='en')
    head
        meta(charset='utf-8')
        meta(http-equiv='X-UA-Compatible', content='IE=edge')
        meta(name='viewport', content='width=device-width, initial-scale=1')
        meta(name='theme-color', content='#00838F')

        if subtitle
            title #{title}: #{subtitle}
        else
            title #{title}
        block head
    body
        header= url
            section.d-flex
                h1
                    a(href='/') #{title}
                if !hideNavigation
                    +navigation
        main(class=locals.user ? 'two-column' : '')
            section
                block content
            if locals.user
                section.sidebar
                    h3 
                        a(href='/user')
                            i.icon account_circle
                            = locals.user.displayName
                    h4 Recent links
                        if app_data && app_data.urls
                            .accordion
                                each url, key in app_data.urls
                                    .accordion__item
                                        .accordion__header
                                            h4= key
                                        .accordion__body
                                            = url
                                        .accordion__footer
                                            a.btn.btn--small(href='/' + key)
                                                i.icon link
                                                | Go to URL
                                            a.btn.btn--warning.btn--small(href='#',data-delete-url=key)
                                                i.icon warning
                                                | Delete
                            script.
                                (function () {
                                    const accordions = document.querySelectorAll('.accordion__item');
                                    if (accordions) {
                                        accordions.forEach((a) => {
                                            const headers = a.querySelectorAll('.accordion__header');
                                            (headers || []).forEach((h) => {
                                                h.addEventListener('click', (ev) => {
                                                    a.classList.toggle('accordion__item--active');
                                                });
                                            });
                                        });
                                    }
                                })();
                        else
                            p No links created yet.


        footer
            section.d-flex
                - let year = new Date().getFullYear()
                p Copyright &copy; #[= year]
                    a(href='//kalle.surf', target='_blank')  Kalle R&auml;is&auml;nen.
                if !hideNavigation
                    +navigation

        link(rel='stylesheet', href='/css/style.css')

        // Start CDN
        script(src='//unpkg.com/unfetch/polyfill')
        link(rel='stylesheet', href='//fonts.googleapis.com/css?family=Lexend+Deca|Staatliches&display=swap')
        link(rel='stylesheet', href='//fonts.googleapis.com/icon?family=Material+Icons')
        // end CDN

        block scripts
